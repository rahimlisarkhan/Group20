<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Firebase</title>
  </head>
  <body>
    <input type="text" id="fullname" /> <br />
    <input type="text" id="age" />

    <button id="sendBtn">Send</button>

    <ul id="list"></ul>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
      integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="./config.js"></script>
    <script src="./index.js"></script>

    <script type="module" defer>
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";

      import {
        getDatabase,
        ref,
        set,
        push,
        get,
        remove,
        update,
        onValue as onDataValue,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

      let app = initializeApp(firebaseConfig);

      const database = getDatabase(app);

      onDataValue(ref(database, "users"), getPersonals);
      //   get(ref(database, "users")).then((snaphot) => {
      //     console.log("data", snaphot.val());
      //   });

      function removePersonal(id) {
        const userRef = ref(database, "users/" + id);

        remove(userRef).then(() => {
          console.log("Success").catch(() => {
            console.log("err");
          });
        });
      }

      function uptPersonal(id, data) {
        const userRef = ref(database, "users/" + id);

        update(userRef, data);
      }

      document.querySelector("#sendBtn").addEventListener("click", function () {
        const fullname = document.querySelector("#fullname").value;
        const age = document.querySelector("#age").value;

        // const id = Date.now();

        const personal = { fullname, age };

        // const userRef = ref(database, "users/"+id);
        const userRef = ref(database, "users");

        // set(userRef, personal);
        push(userRef, personal);
      });

      function getPersonals(snapshot) {
        const data = convertArrayData(snapshot.val());

        document.querySelector("#list").innerHTML = data
          .map(
            (personal) =>
              `<li class="personalItem" data-value="${personal.id}"">id:${personal.id} | ${personal.fullname}:${personal.age} </li>`
          )
          .join("");
      }

      //   document
      //     .querySelector(".personalItem")
      //     .addEventListener("click", function (e) {
      //       console.log("e", e);
      //     });
      //

      //   uptPersonal("-NXpjp59hisj2kg1UqmN", { fullname: "Kenan", age: 34 });

      $(document).on("click", ".personalItem", function () {
        const itemId = $(this).data().value;

        removePersonal(itemId);
      });
    </script>
  </body>
</html>
